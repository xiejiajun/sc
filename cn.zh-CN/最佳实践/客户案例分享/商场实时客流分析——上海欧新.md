# 商场实时客流分析——上海欧新 {#concept_74864_zh .concept}

本文为通过案例为您介绍如何使用实时计算完成Wi-Fi探针客流分析系统。

## 客户简介 {#section_ksc_p5m_2gb .section}

上海欧新软件有限公司专注于室内定位技术和客流统计与分析的研发，如Wi-Fi室内定位引擎、Wi-Fi客流统计与分析系统。在用户导入Wi-Fi客流系统的同时，为商业零售实体店提供了Wi-Fi覆盖，微信上网，定时定地点向客户进行精准化商业信息推送等一体化解决方案。

## 产品简介 {#section_vcw_fwm_2gb .section}

实时客流分析产品主要是基于Wi-Fi探针的客流统计与分析系统，如下图

-   实时热力图

    通过实时客流分析系统，制作每个楼层的实时热力图，不同颜色代表客流人数的密集程度。

    ![实时热力图](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/41099/155114683334772_zh-CN.png)

-   实时客流统计图

    ![实时客流统计图](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/41099/155114683334773_zh-CN.png)


实时客流分析产品主要服务于商场运营方，提供的功能包括：

-   实时客流分析：商场热力图、店铺热力图、客流数、新老客占比、停留时间和客流时间分布等，为运营决策提供数据支持；
-   精准推送：将Wi-Fi探针采集到的地址跟现有数据库进行碰撞，针对碰撞出的用户建立用户画像，根据来店情况进行精准推送；
-   位置定向广告：跟商场线下广告屏幕打通，设定地理围栏与规则，命中规则后个性化推荐广告。

## 系统架构 {#section_wlh_plg_xgb .section}

整个系统的数据源都是Wi-Fi探针，Wi-Fi探针设备的布点是系统成功的关键。在Wi-Fi探针铺设的过程中会预先记录好设备的位置（所属楼层，平面坐标，所属店铺等），且根据业务情况来Wi-Fi探针之间是否重叠：如果要精确，需要多点定位，否则尽量Wi-Fi探针的范围不重叠，防止数据互相污染。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/41099/155114683339604_zh-CN.png)

数据流程

1.  使用Wi-Fi探针采集设备信息。
2.  把采集的数据经过SLB发送到接收服务器。
3.  接受服务器把数据发送到消息队列（DataHub）。
4.  实时计算订阅DataHub数据。
5.  把设备采集到的用户信息跟设备的地理位置信息进行关联。
6.  完成处理，然后把结果写出供下游使用。

实时计算的处理

-   数据清洗、去重。
-   维表关联，用户mac地址与设备地理信息关联，实时数据与历史数据关联。
-   手机品牌识别，位置识别，新客识别。
-   计算停留时间、生成轨迹。

**说明：** 数据收集与清洗部分是整个系统的基础，在这些数据的基础上可再进行精准推送和位置广告等服务。

## 总结 {#section_klf_d4g_xgb .section}

欧新商场实时客流分析平台涉及多台线下设备（2000台设备），实时计算每秒处理输入30K条数据，每秒输出20K条处理后的数据，整体延迟为秒级，整体收益包括：

-   运维成本：免运维，阿里云提供高保障；
-   对接上下游：直接注册，免开发；
-   开发成本：SQL开发，效率高，门槛低，原来单作业Java开发3天的工作量降低到1天内，且BUG少，整个系统重构只需一周。

这套系统打通了线下与线上，为商场的运营方得到了不同维度的数据支持，提高了运营活动的效果，为在顾客打造更好的购物体验的同时也提升商场的整体营收。

商场实时客流分析系统是IoT技术与大数据实时处理技术结合起来的典型案例。

**说明：** 本文部分内容出自上海欧新软件有限公司蔡新峰的分享。

